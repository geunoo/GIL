# Nginx

## Nginx란?

경량 웹서버라고 정의된다.
클라이언트에게 HTTP 요청을 받았을때, 요청에 맞는 정적파일을 응답하는 웹서버의 역할을 수행하기도 하고,
트래픽이 많은 WAS(Web Application Server)서버의 부하를 줄이기 위한 로드밸런서로 사용되기도 한다.

## Apache와 Nginx

아파치 서버는 요청이 들어오면 해당 커넥션을 위해 프로세스를 생성한다.
그러니까 매 요청마다 프로세스를 생성해야 하는 것이다.

시대가 지남에 따라 많은 컴퓨터가 보급되었고, 요청이 늘어나게되면서 커넥션도 늘어나게 되었고,
커넥션이 너무 많아 더이상 생성할 수 없는 일이 생겼다.

### 문제점

Apache는 요청마다 커넥션을 위한 프로세스를 생성한다.
프로세스가 많아지게 되면, 메모리가 부족해진다.

요청을 처리하기 위해 cpu가 프로세스를 사용하게 되면서, 컨텍스트 스위칭을 하고 
이는 cpu의 부하가 늘어나게 된다.

이러한 문제점을 해결하기 위해 Nginx가 나왔다.

## Nginx의 구조

### master process

설정파일에 따라 work process를 생성하는 프로세스이다.

### worker process

실제로 작업을 처리하는 process이다. 
각자 처음에 할당된 listen 소켓에서 요청에 따라 커넥션을 형성하고 처리한다.

생성된 커넥션은 Alive-Keep 시간만큼만 유지된다.

work process는 계속 한 커넥션만 붙잡고 있지 않고,
커넥션에서 요청이 들어오지 않는다면 다른 커넥션을 만들거나 
요청이 들어온 커넥션을 처리한다.

위에서 설명한 것을 event라고 하고,

이 이벤트들은 worker process에서 큐형태로 관리된다.

### Thread Pool

만약 요청이 오래걸린다면, worker process는 스레드풀을 만들어 요청을 따로 처리한다.

worker process는 주로 cpu 코어수 만큼 만들기 때문에, context switching이 잘 일어나지 않아, cpu의 부하를 줄일 수 있다.