# CQRS

# CQRS?

CQRS(**Command Query Responsibility Segregation**)란 명령과 조회의 책임을 분리한다는 뜻이다. 

### Command

명령은 간단히 말해 CRUD에서 Create, Update, Delete를 말하는 것이다. 명령을 통해 데이터값을 변경한다.

### Query

조회는 CRUD에서 Read를 말하는 것으로, 데이터 정보를 조회한다.

## 책임의 분리?

이 명령과 조회의 책임을 분리한다는 말이 쉽게 다가오지 않을 것이다.

우리가 진행하는 프로젝트에서 데이터 정보의 저장, 조회, 수정, 삭제는 데이터베이스에서 담당한다.
여기서 우리는 하나의 모델(엔티티, 테이블처럼 데이터를 담는 객체)을 사용하여 데이터의 CRUD를 하게 된다.

이 모델이 CRUD의 책임을 가지고 있다고 볼 수 있다.

이 하나의 모델을 명령용 모델과 조회용 모델 두개로 나누어 명령과 조회의 책임을 분리하는 것이다.

명령모델에서는 명령만 하고, 조회모델은 조회만 하는 것이다.

## 왜 분리할까?

일단 명령은 주로 하나의 모델에 대한 작업을 수행한다. 
예를 들면 게시글 작성, 수정, 삭제등이 있다.
위 명령들은 모두 게시글 모델 하나만을 필요로 한다.

그러나 조회는 그 이상의 모델들을 필요로 할 수도 있다. 
게시글 조회시 유저의 이름을 같이 조회한다고 하면, 게시글과 유저 두 모델을 필요로 하게 된다.

이런식으로 간단한 조회만 해도 모델이 여러개 필요한데, 단일 모델을 이용하여 CRUD를 사용하게되면
코드가 복잡해진다. 조회시 요구되는 정보가 복잡해지면 쿼리가 복잡해진다.

CQRS를 적용한다면 이를 해결할 수 있다.

## 구현방법

### 모델 분리

같은 데이터베이스에서 모델만 분리하여 구현하는 방법이다.

### DB 분리

데이터베이스를 분리하여 명령모델과 조회모델을 분리하는 것이다.
예를 들면 명령모델은 RDBMS에 저장하고, 조회모델은 MongoDB같은 NoSql에 저장한다면
조회성능을 더 올릴 수 있다.

그러나 DB를 분리하게 된다면, 조회모델이 명령모델의 변경사항을 실시간으로 반영해야하기 때문에
이벤트 소싱 패턴이 들어가게 된다면 구조가 복잡해질 수 있다.