# Transaction

## 개념

Transaction은 한번에 처리되어야하는 하나 이상의 동작으로, 작업의 논리적 단위이다.

## ACID

ACID는 Transaction의 안전성을 보장하기 위해 가지고 있는 특성이다.

- **Atomicity(원자성)**
- **Consistency(일관성)**
- **Isolation(고립성)**
- **Durability(지속성)**

이 4가지가 있다.

### **Atomicity(원자성)**

원자는 더이상 쪼개지지 못하는 물질의 가장 작은 단위이다.
이처럼 하나의 트랜잭션은 더이상 쪼개지지 못하고 하나처럼 동작해야한다는 뜻이다.

그러니까 트랜잭션 작업 수행중에, 일부 동작이 실패한다면 그 트랜잭션은 실패하는 것이다.
모든 동작이 성공해야만 해당 트랜잭션이 성공적으로 종료되고, 그렇지않다면 롤백한다.

### **Consistency(일관성)**

트랜잭션은 데이터베이스의 상태는 일관되게 유지해야한다.

예를 들어 데이터베이스에서 이름은 필수적으로 존재해야한다는 규칙이 있다면
이름을 삭제하는 쿼리는 존재할 수 없는 것이다.

그러니까 트랜잭션이 일어난 이후 데이터베이스의 규칙은 위배되선 안된다는 것이다.

### **Isolation(고립성)**

하나의 트랜잭션이 실행중일때, 다른 트랜잭션은 해당 트랜잭션에 대해 간섭할 수 없다.

트랜잭션 a, b가 같은 값을 변경할때, 동시에 수행된다고 해도
반드시 a 가 수행되고 b가 수행되거나 그 반대로 되거나 이런식으로 순서를 가지고 처리한다.

### **Durability(지속성)**

트랜잭션이 성공적으로 종료된다면, 그 트랜잭션에 의한 조작은 영구적으로 적용되어야한다.

데이터베이스나 OS의 이상종료가 일어나도 견딜 수 있어야 한다.

많은 데이터베이스는 트랜잭션을 로그에 저장하고, 시스템 장애 발생시 그 로그를 이용해 데이터를 복원하여
지속성을 수행하고있다.

# **Transaction 전파**

어떤 트랜잭션이 수행중일때, 다른 트랜잭션이 작동되었을경우 어떻게 처리할 것인가에 관한 것으로,
Spring에서 지원하는 여러가지 옵션으로 트랜잭션 전파 레벨을 설정해 줄 수 있다.

### ****REQUIRED****

Spring의 기본 전파 레벨이다. 
트랜잭션 실행중 다른 트랜잭션이 실행된다면, 먼저 실행된 트랜잭션의 자식 트랜잭션으로써
트랜잭션에 참여하게 된다.

### **REQUIRES_NEW**

이미 실행중인 트랜잭션이 있더라도, 무조건 새로운 트랜잭션을 생성하여
먼저 실행된 트랜잭션이 커밋되기 전에 커밋된다.
두 트랜잭션은 서로가 서로에게 영향을 미칠수 없는 완전히 다른 트랜잭션으로써 실행된다.

위 두 트랜잭션 전파 레벨 외에는 잘 사용되지 않는다고 한다.
간단히 종류만 알아보자.

- **SUPPORTS**
- **NOT_SUPPORTED**
- **MANDATORY**
- **NEVER**
- **NESTED**